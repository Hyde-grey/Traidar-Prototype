version: 1
backend:
  phases:
    # IMPORTANT - Please verify your build commands
    build:
      commands:
        - amplifyPush --simple
frontend:
  phases:
    preBuild:
      commands:
        - nvm use 20
        - yarn
    build:
      commands:
        # Generate the correct AI configuration structure for Gen 2
        - |
          cat << EOF > ./amplify_outputs.json
          {
            "version": "1.0",
            "Auth": {
              "Cognito": {
                "userPoolId": "eu-west-2_Lnpv8PpZ9",
                "userPoolClientId": "5gcd3psg8eku3h2u3ro2oto9n2",
                "identityPoolId": "eu-west-2:bb9541a9-eb31-407b-9313-6d5f119d97c6",
                "region": "eu-west-2"
              }
            },
            "API": {
              "GraphQL": {
                "endpoint": "https://mpnk7jya5fbddlafko7royvsya.appsync-api.eu-west-2.amazonaws.com/graphql",
                "region": "eu-west-2",
                "apiKey": "da2-wuqj3qyirjeblgmowt42fpbunq",
                "defaultAuthMode": "userPool"
              }
            },
            "ai": {
              "region": "eu-west-2",
              "conversation": {
                "chat": {
                  "model": "anthropic.claude-3-haiku-20240307-v1:0",
                  "provider": "bedrock",
                  "region": "eu-west-2"
                }
              }
            }
          }
          EOF
        - yarn build
  artifacts:
    baseDirectory: dist
    files:
      - "**/*"
  cache:
    paths:
      - node_modules/**/*
