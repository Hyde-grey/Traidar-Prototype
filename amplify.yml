version: 1
backend:
  phases:
    # IMPORTANT - Please verify your build commands
    build:
      commands:
        - amplifyPush --simple
frontend:
  phases:
    preBuild:
      commands:
        - nvm use 20
        - yarn
    build:
      commands:
        # Generate the correct AI configuration structure
        - |
          cat << EOF > ./amplify_outputs.json
          {
            "version": "1",
            "auth": {
              "user_pool_id": "eu-west-2_Lnpv8PpZ9",
              "aws_region": "eu-west-2",
              "user_pool_client_id": "5gcd3psg8eku3h2u3ro2oto9n2",
              "identity_pool_id": "eu-west-2:bb9541a9-eb31-407b-9313-6d5f119d97c6"
            },
            "data": {
              "url": "https://mpnk7jya5fbddlafko7royvsya.appsync-api.eu-west-2.amazonaws.com/graphql",
              "aws_region": "eu-west-2",
              "api_key": "da2-wuqj3qyirjeblgmowt42fpbunq",
              "default_authorization_type": "AMAZON_COGNITO_USER_POOLS"
            },
            "ai": {
              "aws_region": "eu-west-2",
              "conversation": {
                "chat": {
                  "model": "anthropic.claude-3-haiku-20240307-v1:0",
                  "provider": "bedrock",
                  "region": "eu-west-2"
                }
              }
            }
          }
          EOF
        - yarn build
  artifacts:
    baseDirectory: dist
    files:
      - "**/*"
  cache:
    paths:
      - node_modules/**/*
